# Документация

## Описание
Проект представляет собой создание системы управления электронного обучения. Данная часть проекта отвечает за разработку базы данных на СУБД PostgreSQL в графической среде pgAdmin, а также за сопровождение проекта.

## Структура базы данных
В базе данных реализованы сущности и связи между ними:
1. **Пользователи и роли**
- `users`, `student`, `teacher`, `administrator`, `auditor`
- Пользователь, студент, преподаватель, администратор, вольнослушатель.
2. **Структура**
- `faculty`, `division`, `teacher_division`, `student_group`
- Факультет, подразделение, кафедра преподавателя, группа.
3. **Курсы и модули**
- `course`, `academic_year`, `course_module`, `course_material`, `course_application`, `course_enrollment`, `course_settings`
- Курс, учебный год, модуль курса, материал курса, заявка на курс, запись на курс, настройки курса.
4. **Задания и оценки**
- `task`, `task_grade`
- Задание, оценка
5. **Тесты и результаты**
- `test`, `test_question`, `test_option`, `test_result`
- Тест, вопрос, вариант ответа, результат теста.
6. **Журнал**
- `journal`
- Журнал всех результатов.
7. **Файлы**
- `file`
- Загружаемые учебные файлы, текстовые материалы.
8. **Личный кабинет**
- `user_profile`
- Хранение контактной информации пользователя.
9. **Настройки уведомления**
- `notification_settings`
- Вкл/выкл уведомлений о новых задачах, дедлайнах, результатах.
10. **Архивация курса**
- `course_archive`
- Перевод курса в архив.

Все таблицы имеют внешние ключи, ограничения и уникальные индексы.

## Технологии
1. Типы ENUM — перечисления
   ```
   CREATE TYPE admin_status AS ENUM ('Активен', 'Заблокирован');
   ```
   - Ограничение допустимых значений в столбцах.
3. Автоинкрементные поля
   ```
   id_user INT PRIMARY KEY GENERATED ALWAYS AS IDENTITY
   ```
   - Генерация уникальных идентификаторов без ручного определения id.
4. Внешние ключи
   ```
   id_user INT NOT NULL REFERENCES users(id_user) ON DELETE CASCADE
   ```
   - При удалении основной записи автоматически удаляются связанные.
5. Индексы
   ```
   CREATE UNIQUE INDEX idx_users_email ON users(email);
   ```
   - Ускорение выполнения запросов SELECT, JOIN, WHERE.
6. Составные ключи
    ```
    PRIMARY KEY (id_teacher, id_division)
    ```
    - Обеспечение уникальности значений в связующих таблицах.
7. Уникальные ограничения
    ```
    UNIQUE (id_user)
    ```
    - Запрет дублирования значений в указанных столбцах.
8. CHECK-ограничения
    ```
    course_number INT NOT NULL CHECK (course_number BETWEEN 1 AND 6)
    ```
    - Проверка допустимости значений.
9. Генерируемые столбцы
    ```
    percentage NUMERIC(5,2) GENERATED ALWAYS AS (
        CASE WHEN max_score = 0 THEN 0 
        ELSE ROUND((score::NUMERIC / max_score) * 100, 2) 
        END
    ) STORED
    ```
    - Автоматический расчет значения.
10. TIMESTAMP и TIMESTAMPTZ — дата и время
    ```
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
    ```
    - Использование временных меток с часовым поясом.
11. INTERVAL — разница времени
    ```
    time_spent INTERVAL GENERATED ALWAYS AS (
        finished_at - started_at
    ) STORED
    ```
    - Автоматический подсчёт времени выполнения теста.
12. DEFAULT значения
    ```
    status application_status NOT NULL DEFAULT 'На рассмотрении'
    ```
    - Значения по умолчанию.
13. BOOLEAN-поля
    ```
    notification_new_task BOOLEAN DEFAULT TRUE
    ```
    - Хранение состояний "да/нет" и "включено/выключено".
14. Модульная структура
    - Курсы состоят из модулей `course_module`, которые содержат материалы, задания, тесты.
15. Разграничение ролей
    - Через отдельные таблицы: `student`, `teacher`, `auditor`, `administrator`.
16. Архивирование
    - Таблица `course_archive`, позволяющая привязывать курсы к архивным учебным годам.

## ER-диаграмма
ER-диаграмма отображает структуру базы данных всей системы управления электронного обучения.

Для просмотра ER-диаграммы необходимо перейти на сайт [app.diagrams.net](https://app.diagrams.net/) и открыть файл «ER-диаграмма».

## pgAdmin
1. Для отображения таблиц в pgAdmin необходимо скачать [PostgreSQL17](https://www.postgresql.org/download/windows/).
2. Открыть pgAdmin и создать пустую базу данных. Для этого кликнуть правой кнопкой по вкладке «Базы данных» и выбрать пункт «Создать».
3. Следующим этапом кликнуть правой кнопкой и выбрать пункт «Восстановить».
4. Далее указать формат дампа базы данных «Специальный» и путь к файлу «Project_2» с расширением .backup.
